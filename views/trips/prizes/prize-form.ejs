<style>
    #prize-form {
        background: var(--bg-secondary);
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
    }

    #prize-form h2 {
        margin-top: 0;
        margin-bottom: 20px;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }

    .form-group select,
    .form-group textarea {
        width: 100%;
        box-sizing: border-box;
    }

    .form-group textarea {
        min-height: 100px;
        resize: vertical;
        font-family: inherit;
    }
</style>

<form id="prize-form" hx-post="/trips/<%= currentOrUpcomingTrip.slug %>/playground/prizes/new"
    hx-target="#prize-form-container" hx-swap="innerHTML">
    <h2>Otorgar un premio</h2>

    <div class="form-group">
        <label for="awardee-select">Premiado:</label>
        <select name="awardee" id="awardee-select" placeholder="Elegí un amigo" class="pixel-input" required>
            <% avatars.forEach(avatar => { %>
            <option value="<%= avatar.id %>"
                <% if(typeof selectedAwardee != "undefined" && selectedAwardee == avatar.id) {%> selected <% } %>
                data-custom-properties='{"img":"/images/avatars/thumbs/<%= avatar.avatar_head_file_name %>"}'>
                <%= avatar.handle %>
            </option>
            <% }) %>
        </select>
    </div>

    <div class="form-group">
        <label for="reason-input">Razón del premio:</label>
        <textarea name="reason" id="reason-input" class="pixel-input"
            placeholder="Por qué merece este premio?"><%= typeof selectedReason != 'undefined' ? selectedReason : '' %></textarea>
    </div>

    <button type="submit" class="button">Otorgar Premio</button>
</form>

<script>
    document.body.addEventListener('htmx:beforeRequest', function (event) {
        debugger;
        if (event.target.id === 'prize-form') {
            if (!validatePrizeForm()) {
                event.preventDefault();
                hideSpinner();
            }
        }
    });

    function validatePrizeForm() {
        debugger;
        const awardee = document.getElementById('awardee-select').value;
        if (!awardee) {
            showToast('Tenés que elegir un usuario!', 'error');
            return false;
        }

        const reason = document.getElementById('reason-input').value.trim();
        if (!reason) {
            showToast('Tenés que escribir una razón!', 'error');
            return false;
        }

        return true;
    }
</script>