<%- include('partials/header') %>

<div class="layout">
    <aside class="sidebar left">
        <!-- e.g. Profile / Trip Switcher -->
        <%- include('partials/sidebar-left', { trips, trip }) %>
    </aside>

    <main class="feed">
        <!-- your current post loop goes here -->
        <h2><%= trip.name %></h2>

        <% if (posts.length === 0) { %>
        <p>No posts yet for this trip. Be the first to share!</p>
        <% } else { %>

        <!-- Everything related to creating a new post
        <div id="post-controls">
            <button id="showPostForm" class="button" style="margin-bottom: 20px;">+ New Post</button>

            <div id="postModal" class="modal hidden">
                <div class="modal-content">
                    <button id="closePostModal" class="modal-close">âœ–</button>
                    <%- include('partials/new-post-form', { trip }) %>
                </div>
            </div>
        </div> -->

        <div id="post-inject-point"></div>

        <div id="post-list" class="grid">
            <!-- New Post Button -->
            <% posts.forEach(post => { %>
            <%- include('partials/post', { post }) %>
            <% }) %>
        </div>
        <% } %>
    </main>

    <aside class="sidebar right">
        <!-- e.g. Suggested posts / About Ratambuzza -->
        <%- include('partials/sidebar-right') %>
    </aside>
</div>

<script>
    const modal = document.getElementById('postModal')
    const openBtn = document.getElementById('showPostForm')
    const closeBtn = document.getElementById('closePostModal')

    openBtn.addEventListener('click', () => {
        modal.classList.remove('hidden')
    })

    closeBtn.addEventListener('click', () => {
        modal.classList.add('hidden')
    })

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            modal.classList.add('hidden')
        }
    })
    document.body.addEventListener('htmx:afterRequest', (evt) => {
        // Close modal after post form submission
        if (evt.target.closest('form')?.id === 'newPostForm') {
            document.getElementById('postModal')?.classList.add('hidden')
        }
    })
</script>


<%- include('partials/footer') %>