<div class="media-item" id="media-item-<%=item.id%>">
    <a href="<%= item.url %>" class="gallery-item" data-media-id="<%= item.id %>">
        <img class="media-item-image" src="<%= item.thumbnail_url %>" alt="Uploaded image">
    </a>
    <div class="overlay">
        <!-- <div class="overlay-top">
                    <img id="avatar-head" src="/images/avatars/thumbs/<%= item.uploader_avatar %>"
                        alt="<%= item.uploader_name %>" title="<%= item.uploader_name %>">
                </div> -->
        <div class="overlay-bottom">
            <button onclick="window.openLightboxFromElement(this)" class="overlay-btn"
                title="Play">‚ñ∂Ô∏è</button>
            <div id="like-button-container-<%= item.id %>">
                <%- include('./like-button-gallery',{
                        mediaId: item.id,
                        liked: item.userLiked,
                        count: item.likesCount
                    })%>
            </div>
            <a href="<%-item.url%>" download class="download-link">
                <button class="overlay-btn" title="Download">‚¨áÔ∏è</button>
            </a>
            <% if (currentUser.id === item.user_id || currentUser.role == 'admin') { %>
            <button class="overlay-btn" title="Edit Tags"
                hx-get="/trips/<%-currentOrUpcomingTrip.slug%>/gallery/<%=item.id %>/tags/edit"
                hx-target="#tag-editor-<%= item.id %>" hx-swap="innerHTML">
                üè∑Ô∏è
            </button>
            <button class="overlay-btn" data-media-id="<%= item.id %>" title="Delete"
                onclick="window.deleteThisItem(this)">
                ‚ùå
            </button>
            <% } %>
        </div>
        <div id="tag-editor">
            <!-- üß© Placeholder for tag editor form -->
            <br>
            <div id="tag-editor-<%= item.id %>" data-media-id="<%= item.id %>">
                <%- include('tag-pills', {currentTags: item.tags ? item.tags.split(',') : []}) %>
            </div>
        </div>
    </div>
</div>


<script>
    // este c√≥digo es para hookear el delete button y luego de borrar
    // si no hay m√°s items, pintar un mensaje
    (() => {
        window.deleteThisItem = async function (e) {

            const mediaId = e.dataset.mediaId;
            const mediaItem = e.closest('.media-item');

            if (!confirm('Seguro de borrar este item?')) return;

            try {
                await window.htmxAjaxPromise('DELETE', `/trips/<%-currentOrUpcomingTrip.slug%>/gallery/${mediaId}/delete`, {
                    target: mediaItem,
                    swap: 'outerHTML'
                });

                // After the swap, check if any media items remain
                const remaining = document.querySelectorAll('.media-item').length;
                if (remaining === 0) {
                    document.getElementById('no-images-message').textContent = 'Nada que ver aqu√≠ :/'
                }

            } catch (err) {
                console.error('Error deleting media:', err);
                showToast('Error al borrar el item', 'error');
            }
        };
    })()
</script>